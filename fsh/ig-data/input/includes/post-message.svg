<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1023" height="796"><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="1023" height="796"/></g><g><g><path fill="lightblue" stroke="black" paint-order="fill stroke markers" d=" M 191.80538515473825 8.821009782000004 L 736.7090377127499 8.821009782000004 L 736.7090377127499 789.2164991280002 L 191.80538515473825 789.2164991280002 L 191.80538515473825 8.821009782000004" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8.4pt" font-style="normal" font-weight="bold" text-decoration="normal" x="403.5705888141152" y="32.645275518000005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">EHR Browser Interface</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8.4pt" font-style="normal" font-weight="normal" text-decoration="normal" x="403.5705888141152" y="50.739654558000005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">https:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8.4pt" font-style="normal" font-weight="normal" text-decoration="normal" x="430.96350263247456" y="50.739654558000005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">//</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8.4pt" font-style="normal" font-weight="normal" text-decoration="normal" x="437.1869218219277" y="50.739654558000005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">ehr.example.org</text></g><g><path fill="lightgreen" stroke="black" paint-order="fill stroke markers" d=" M 622.2204775462109 65.51673077400001 L 729.16971311275 65.51673077400001 L 729.16971311275 789.2164991280002 L 622.2204775462109 789.2164991280002 L 622.2204775462109 65.51673077400001" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8.4pt" font-style="normal" font-weight="bold" text-decoration="normal" x="629.3256266405156" y="89.34099651" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">embedded iframe</text></g><g><path fill="pink" stroke="black" paint-order="fill stroke markers" d=" M 889.1743551644608 65.51673077400001 L 1007.3180945151796 65.51673077400001 L 1007.3180945151796 789.2164991280002 L 889.1743551644608 789.2164991280002 L 889.1743551644608 65.51673077400001" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8.4pt" font-style="normal" font-weight="bold" text-decoration="normal" x="903.1236357284921" y="89.34099651" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">EHR Auth Server</text></g><rect fill="rgb(255,237,204)" stroke="none" x="462.21583549449997" y="168.730084548" width="538.8056615453203" height="182.60244181200002"/></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 243.72414051124997 149.881773048 L 243.72414051124997 789.2164991280002" stroke-miterlimit="10" stroke-width="1.2565541"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 675.6950953294804 149.881773048 L 675.6950953294804 789.2164991280002" stroke-miterlimit="10" stroke-width="1.2565541"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 948.2462248398202 149.881773048 L 948.2462248398202 789.2164991280002" stroke-miterlimit="10" stroke-width="1.2565541"/></g><g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 199.34470975473826 105.39975790800001 L 288.1035712677617 105.39975790800001 L 288.1035712677617 149.881773048 L 199.34470975473826 149.881773048 L 199.34470975473826 105.39975790800001 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8.4pt" font-style="normal" font-weight="normal" text-decoration="normal" x="215.70504413673825" y="133.898404896" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">ehr.window</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 629.7598021462109 105.39975790800001 L 721.63038851275 105.39975790800001 L 721.63038851275 149.881773048 L 629.7598021462109 149.881773048 L 629.7598021462109 105.39975790800001 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8.4pt" font-style="normal" font-weight="normal" text-decoration="normal" x="646.1201365282109" y="133.898404896" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">app.window</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 896.7136797644608 105.39975790800001 L 999.7787699151796 105.39975790800001 L 999.7787699151796 149.881773048 L 896.7136797644608 149.881773048 L 896.7136797644608 105.39975790800001 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8.4pt" font-style="normal" font-weight="normal" text-decoration="normal" x="913.0740141464609" y="133.898404896" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">authorize.html</text></g></g><g><g><g><rect fill="rgb(255,237,204)" stroke="none" x="809.5203795896502" y="198.133450488" width="4.90056099" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="811.9706600846503" y="211.704234768" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"></text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 935.8314703318202 217.735694448 L 688.1098498374804 217.735694448" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="6.03145968"/><g transform="translate(675.6950953294804,217.735694448) translate(-675.6950953294804,-217.735694448)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 688.2606363294805 211.452923948 L 675.6950953294804 217.735694448 L 688.2606363294805 224.018464948 Z"/><g transform="translate(948.2462248398202,217.735694448) translate(-948.2462248398202,-217.735694448)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 935.6806838398202 211.452923948 L 948.2462248398202 217.735694448 L 935.6806838398202 224.018464948 Z"/></g></g></g><path fill="lightyellow" stroke="black" paint-order="fill stroke markers" d=" M 469.75516009449996 229.04468134800004 L 881.6350305644609 229.04468134800004 L 881.6350305644609 340.02353946000005 L 469.75516009449996 340.02353946000005 L 469.75516009449996 229.04468134800004" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="monospace" font-size="8.4pt" font-style="normal" font-weight="normal" text-decoration="normal" x="490.86526897449994" y="252.86894708400004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">launchClientData = {</text><text fill="black" stroke="none" font-family="monospace" font-size="8.4pt" font-style="normal" font-weight="normal" text-decoration="normal" x="490.86526897449994" y="270.96332612400005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  "smart_web_messaging_handle": </text><text fill="black" stroke="none" font-family="monospace" font-size="8.4pt" font-style="normal" font-weight="bold" text-decoration="normal" x="705.9399760057499" y="270.96332612400005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">"RXhhbXBsZSBoYW5kbGUK"</text><text fill="black" stroke="none" font-family="monospace" font-size="8.4pt" font-style="normal" font-weight="normal" text-decoration="normal" x="853.8038370897343" y="270.96332612400005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">,</text><text fill="black" stroke="none" font-family="monospace" font-size="8.4pt" font-style="normal" font-weight="normal" text-decoration="normal" x="490.86526897449994" y="289.057705164" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  "smart_messaging_origin": </text><text fill="black" stroke="none" font-family="monospace" font-size="8.4pt" font-style="normal" font-weight="bold" text-decoration="normal" x="679.0556376268437" y="289.057705164" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">"https:</text><text fill="black" stroke="none" font-family="monospace" font-size="8.4pt" font-style="normal" font-weight="bold" text-decoration="normal" x="726.1032297899296" y="289.057705164" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">//</text><text fill="black" stroke="none" font-family="monospace" font-size="8.4pt" font-style="normal" font-weight="bold" text-decoration="normal" x="739.5453989793828" y="289.057705164" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">ehr.example.org"</text><text fill="black" stroke="none" font-family="monospace" font-size="8.4pt" font-style="normal" font-weight="normal" text-decoration="normal" x="847.0827524950078" y="289.057705164" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">,</text><text fill="black" stroke="none" font-family="monospace" font-size="8.4pt" font-style="normal" font-weight="normal" text-decoration="normal" x="490.86526897449994" y="307.152084204" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">...</text><text fill="black" stroke="none" font-family="monospace" font-size="8.4pt" font-style="normal" font-weight="normal" text-decoration="normal" x="490.86526897449994" y="325.246463244" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">}</text></g><g><text fill="black" stroke="none" font-family="monospace" font-size="8.4pt" font-style="normal" font-weight="normal" text-decoration="normal" x="290.5663150028847" y="405.314090496" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">postMessage(message, </text><text fill="black" stroke="none" font-family="monospace" font-size="8.4pt" font-style="normal" font-weight="bold" text-decoration="normal" x="431.70909149214253" y="405.314090496" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">"https:</text><text fill="black" stroke="none" font-family="monospace" font-size="8.4pt" font-style="normal" font-weight="bold" text-decoration="normal" x="478.75668365522847" y="405.314090496" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">//</text><text fill="black" stroke="none" font-family="monospace" font-size="8.4pt" font-style="normal" font-weight="bold" text-decoration="normal" x="492.1988528446816" y="405.314090496" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">ehr.example.org"</text><text fill="black" stroke="none" font-family="monospace" font-size="8.4pt" font-style="normal" font-weight="normal" text-decoration="normal" x="599.7362063603066" y="405.314090496" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">)</text><text fill="black" stroke="none" font-family="monospace" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="606.4572909550332" y="405.314090496" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    </text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 675.6950953294804 412.55184211200003 L 256.13889501924996 412.55184211200003" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(243.72414051124997,412.55184211200003) translate(-243.72414051124997,-412.55184211200003)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 256.28968151124997 406.269071612 L 243.72414051124997 412.55184211200003 L 256.28968151124997 418.83461261200006 Z"/></g></g><path fill="lightyellow" stroke="black" paint-order="fill stroke markers" d=" M 473.11570239186324 423.86082901200007 L 878.2744882670976 423.86082901200007 L 878.2744882670976 552.9340661640001 L 473.11570239186324 552.9340661640001 L 473.11570239186324 423.86082901200007" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="monospace" font-size="8.4pt" font-style="normal" font-weight="normal" text-decoration="normal" x="494.2258112718632" y="447.68509474800004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">message = {</text><text fill="black" stroke="none" font-family="monospace" font-size="8.4pt" font-style="normal" font-weight="normal" text-decoration="normal" x="494.2258112718632" y="465.779473788" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  "messageId": </text><text fill="black" stroke="none" font-family="monospace" font-size="8.4pt" font-style="normal" font-weight="bold" text-decoration="normal" x="595.0420801927617" y="465.779473788" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">"248cd0b0-5167-4824-babc-f250e5296527"</text><text fill="black" stroke="none" font-family="monospace" font-size="8.4pt" font-style="normal" font-weight="normal" text-decoration="normal" x="850.443294792371" y="465.779473788" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">,</text><text fill="black" stroke="none" font-family="monospace" font-size="8.4pt" font-style="normal" font-weight="normal" text-decoration="normal" x="494.2258112718632" y="483.873852828" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  "messagingHandle": </text><text fill="black" stroke="none" font-family="monospace" font-size="8.4pt" font-style="normal" font-weight="bold" text-decoration="normal" x="635.368587761121" y="483.873852828" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">"RXhhbXBsZSBoYW5kbGUK"</text><text fill="black" stroke="none" font-family="monospace" font-size="8.4pt" font-style="normal" font-weight="normal" text-decoration="normal" x="783.2324488451054" y="483.873852828" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">,</text><text fill="black" stroke="none" font-family="monospace" font-size="8.4pt" font-style="normal" font-weight="normal" text-decoration="normal" x="494.2258112718632" y="501.968231868" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  "messageType": "ui.launchActivity",</text><text fill="black" stroke="none" font-family="monospace" font-size="8.4pt" font-style="normal" font-weight="normal" text-decoration="normal" x="494.2258112718632" y="520.062610908" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  "payload": {...}</text><text fill="black" stroke="none" font-family="monospace" font-size="8.4pt" font-style="normal" font-weight="normal" text-decoration="normal" x="494.2258112718632" y="538.156989948" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">}</text></g><g><text fill="black" stroke="none" font-family="monospace" font-size="8.4pt" font-style="normal" font-weight="normal" text-decoration="normal" x="301.76412994429097" y="606.9156303000002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">postMessage(response, "https:</text><text fill="black" stroke="none" font-family="monospace" font-size="8.4pt" font-style="normal" font-weight="normal" text-decoration="normal" x="496.6755831913613" y="606.9156303000002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">//</text><text fill="black" stroke="none" font-family="monospace" font-size="8.4pt" font-style="normal" font-weight="normal" text-decoration="normal" x="510.1177523808144" y="606.9156303000002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">app/after-auth")</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 243.72414051124997 614.1533819160002 L 663.2803408214804 614.1533819160002" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(675.6950953294804,614.1533819160002) translate(-675.6950953294804,-614.1533819160002)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 663.1295543294804 607.8706114160002 L 675.6950953294804 614.1533819160002 L 663.1295543294804 620.4361524160001 Z"/></g></g><path fill="lightyellow" stroke="black" paint-order="fill stroke markers" d=" M 7.5393246000000005 625.4623688160002 L 479.90895642249995 625.4623688160002 L 479.90895642249995 736.4412269280002 L 7.5393246000000005 736.4412269280002 L 7.5393246000000005 625.4623688160002" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="monospace" font-size="8.4pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="649.2866345520004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">response = {</text><text fill="black" stroke="none" font-family="monospace" font-size="8.4pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="667.3810135920004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  "messageID": "9befe172-f5b2-408b-a993-939690f5388b",</text><text fill="black" stroke="none" font-family="monospace" font-size="8.4pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="685.4753926320004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  "responseToMessageId": </text><text fill="black" stroke="none" font-family="monospace" font-size="8.4pt" font-style="normal" font-weight="bold" text-decoration="normal" x="196.67654834816403" y="685.4753926320004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">"248cd0b0-5167-4824-babc-f250e5296527"</text><text fill="black" stroke="none" font-family="monospace" font-size="8.4pt" font-style="normal" font-weight="normal" text-decoration="normal" x="452.0777629477734" y="685.4753926320004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">,</text><text fill="black" stroke="none" font-family="monospace" font-size="8.4pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="703.5697716720005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  "payload": {...}</text><text fill="black" stroke="none" font-family="monospace" font-size="8.4pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="721.6641507120005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">}</text></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 462.21583549449997 168.730084548 L 1001.0214970398202 168.730084548 L 1001.0214970398202 351.33252636000003 L 462.21583549449997 351.33252636000003 L 462.21583549449997 168.730084548 Z" stroke-miterlimit="10" stroke-width="2.154092742857143" stroke-dasharray=""/><path fill="orange" stroke="black" paint-order="fill stroke markers" d=" M 462.21583549449997 168.730084548 L 462.21583549449997 186.82446358800001 L 547.4925186601249 186.82446358800001 L 556.5397081801249 177.777274068 L 556.5397081801249 168.730084548 L 462.21583549449997 168.730084548" stroke-miterlimit="10" stroke-width="2.154092742857143" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="477.29448469449994" y="180.793003908" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">SMART Launch</text></g></g></g></svg>
<!--

SVG Source: https://sequencediagram.org/
========================================

entryspacing 0.5
participantgroup #lightblue ++**EHR Browser Interface**\nhttps://ehr.example.org++

participantspacing 5
participant "++ehr.window++" as ehr.window
lifelinestyle ehr.window ::solid

participantgroup #lightgreen ++**embedded iframe**++
 participant "++app.window++" as app.window
 end
 lifelinestyle app.window ::solid
end

participantgroup #pink ++**EHR Auth Server**++
participant "++authorize.html++" as authorize.html
lifelinestyle ::solid
end


parallel
group #orange SMART Launch
authorize.html<->app.window: 
parallel off


fontfamily monospace
box over app.window #lightyellow: ++launchClientData = {\n  "smart_web_messaging_handle": **"RXhhbXBsZSBoYW5kbGUK"**,\n  "smart_messaging_origin": **"https://ehr.example.org"**,\n...\n}++
end

space 1
ehr.window<-app.window: ++postMessage(message, **"https://ehr.example.org"**)++    
box over app.window #lightyellow: ++message = {\n  "messageId": **"248cd0b0-5167-4824-babc-f250e5296527"**,\n  "messagingHandle": **"RXhhbXBsZSBoYW5kbGUK"**,\n  "messageType": "ui.launchActivity",\n  "payload": {...}\n}++

space 1
app.window<-ehr.window: ++postMessage(response, "https://app/after-auth")++
fontfamily monospace
box over ehr.window #lightyellow: ++response = {\n  "messageID": "9befe172-f5b2-408b-a993-939690f5388b",\n  "responseToMessageId": **"248cd0b0-5167-4824-babc-f250e5296527"**,\n  "payload": {...}\n}++
fontfamily arial
-->
